<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tasklist - VP</title>
    <link rel="stylesheet" href="css/index.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
</head>
<body>

    <h1>Tasklist - Victor Prieto</h1>
    <ul id="llista">
    </ul>
    <button id="btnAfegir">Afegir Tasca</button>

    <div id="dialogAfegir" title="Afegir Tasca" style="display:none;">
        <input type="text" id="inputNovaTasca" placeholder="Escriu el nom de la tasca..." />
    </div>
    <div id="dialogEditar" title="Editar Tasca" style="display:none;">
        <input type="text" id="inputEditarTasca" placeholder="Escriu el nou nom..." />
    </div>

    <script>
        $(function(){
            var llista = $('#llista');
            var KEY = 'tasques';
            var editSpan = null;

            function guardar(){
                var tasques = llista.find('span').map(function(){ 
                    return $(this).text(); 
                }).get();
                localStorage.setItem(KEY, JSON.stringify(tasques));
            }

            function cargar(){
                var tasques = JSON.parse(localStorage.getItem(KEY) || '[]');
                tasques.forEach(function(text){
                    afegir(text);
                });
            }

            function afegir(text){
                var li = $('<li><span>' + text + '</span><div class="btns"><button>Editar</button><button>Eliminar</button></div></li>');
                
                li.find('button:first').click(function(){
                    editSpan = li.find('span');
                    $('#inputEditarTasca').val(editSpan.text());
                    $('#dialogEditar').dialog('open');
                });
                
                li.find('button:last').click(function(){
                    li.fadeOut(300, function(){ 
                        li.remove(); 
                        guardar();
                    });
                });

                llista.append(li);
            }

            $('#dialogAfegir').dialog({
                autoOpen: false,
                modal: true,
                buttons: {
                    "Afegir": function(){
                        var nom = $('#inputNovaTasca').val().trim();
                        if(nom){
                            afegir(nom);
                            guardar();
                            $('#inputNovaTasca').val('');
                            $(this).dialog('close');
                        }
                    },
                    "Cancel·lar": function(){
                        $(this).dialog('close');
                    }
                }
            });

            $('#dialogEditar').dialog({
                autoOpen: false,
                modal: true,
                buttons: {
                    "Desar": function(){
                        var nom = $('#inputEditarTasca').val().trim();
                        if(nom && editSpan){
                            editSpan.text(nom);
                            guardar();
                            $(this).dialog('close');
                        }
                    },
                    "Cancel·lar": function(){
                        $(this).dialog('close');
                    }
                }
            });

            $('#btnAfegir').click(function(){
                $('#dialogAfegir').dialog('open');
            });

            cargar();
        });
    </script>

</body>
</html>